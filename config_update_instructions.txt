
# 在src/main.py的MODELS配置中，将TWO_STAGE_VAR_ST的vqvae_config更新为：

'TWO_STAGE_VAR_ST': {
    'model_name': 'TWO_STAGE_VAR_ST',
    'num_genes': 200,
    'histology_feature_dim': 1024,
    'spatial_coord_dim': 2,
    # Stage 1 VQVAE 改进配置
    'vqvae_config': {
        'vocab_size': 4096,
        'embed_dim': 128,
        'beta': 0.5,  # 🔧 增大commitment loss权重 (原0.25)
        'hierarchical_loss_weight': 0.1,
        'vq_loss_weight': 0.5,  # 🔧 增大VQ损失权重 (原0.25)
        'use_ema': True,  # 🆕 启用EMA更新
        'ema_decay': 0.99,
    },
    # Stage 2 VAR Transformer 配置 (不变)
    'var_config': {
        'vocab_size': 4096,
        'embed_dim': 640,
        'num_heads': 8,
        'num_layers': 12,
        'feedforward_dim': 2560,
        'dropout': 0.1,
        'max_sequence_length': 1500,
        'condition_embed_dim': 640
    }
}
